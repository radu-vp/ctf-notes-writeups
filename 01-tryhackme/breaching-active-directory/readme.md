# Breaching Active Directory

## How to connect to the network

Download the OpenVPN file specific to this network and run it with `sudo openvpn file_name.ovpn`

From a Kali VM, configure the file in `/etc/resolv.conf` as shown:

**Before**

```bash
# Generated by NetworkManager
search cyber.range
nameserver 10.0.0.1
```

**After**

* `10.200.28.101` was the IP address of the THM Domain Controller (THMDC) in the network diagram.

```bash
# Generated by Network Manager
search cyber.range za.tryhackme.com
nameserver 10.200.28.101
nameserver 127.0.0.53
# Shorten name resolution timeouts to 1 second
options timeout: 1
# Only attempt to resolve a hostname 2 times
options attempt: 2
```

Lastly, run `sudo systemctl restart networking.service` to apply the changes.

## Test Hostname Lookups

```bash
nslookup thmdc.za.tryhackme.com
nslookup google.com
```

* Network Manager -> Advanced Network Configuration -> Your Connection -> IPv4 Settings
* Set your DNS IP for the THM domain controller
* Add another DNS such as 1.1.1.1 or similar to ensure you still have internet access
* run `sudo systemctl restart NetworkManager` and test your DNS


Configure the DNS on the host where you are using the VPN to connect to the network

```bash
[user@linux]$ systemd-resolve --interface breachad --set-dns $THMDCIP --set-domain za.tryhackme.com
# if systemd-resolve doesnt work, TRY:
resolvectl --interface breachad --set-dns $THMDCIP --set-domain za.tryhackme.com
```

* where `$THMDCIP` is the IP of the THM Domain Controller (DC) (such as 10.200.28.101)

Then you need to check your IP associated with the interface `breachad` and make a note of it, as it is the IP you will be using to perform tasks.