# Basic Malware RE

Link: [Basic Malware RE](https://tryhackme.com/room/basicmalware)

## High-Level Overview

This is a static analysis malware challenge. The rules state we are **not** allowed to use debuggers or run the executables/programs.

## Tools Needed

* Ghidra
* Strings

## Challenge 1

For the first challenge, we have an executable that prints an MD5 Hash on the screen when we run it.

Unzipping the given archive, we see it contains a file called `strings1.exe_`.

Since we cannot run this executable, we cannot confirm the value of the MD5 hash to aid us in some way.

Running the command `strings strings1.exe_` does not appear to be very useful at first glance, since there are many strings identified that are formatted like `FLAG{THIS-IS-NOT-THE-REAL-FLAG}`

To investigate further we will use `ghidra`, but since we are **not** allowed to run the malware or use the debugging features, we will resort to the `code browser` capability.

Once the file was loaded into `ghidra`, we can proceed to `autoanalyze` while making sure that we don't enable any debugging or dynamic analysis features.

If we look around, we can see the list of flag strings and their memory offset in the `.rdata` and `.data` sections.

Digging around a bit in the headers section, we find the offset address for something called `entry`, with the offset of `00400108`. It also has an `OptionalHeader` which is listed as `AddressOfEntryPoint`.

Double-clicking on the `entry` we can see the decompiled function `void entry(void)` that takes a string and hashes it using MD5. The string is `FLAG{CAN-I-MAKE-IT-ANYMORE-OBVIO_00432294}`. Going to where this string has the offset address we can see its full name. This is the flag for completing the challenge.

## Challenge 2

For the next challenge, we have an executable named `strings2.exe_` that behaves in a similar way.

Using the command `strings strings2.exe_` does not give us any immediately apparent useful information, as this time there are no strings that contain the word **FLAG**.

Once again, we load the executable in `Ghidra`, we `autoanalyze` it and then we begin exploring.

In the `Symbol Tree` tab in `Ghidra`, expanding the `Functions` list, we can see the function `entry` which is likely where we can find our flag.

We see a long list of variables that upon further exploring, they seem to be addressed in reverse order. We see the variable `local_2c` is attributed the string `F`, and upon inspecting the memory offset for the variables, it seems like this is the first one being called. The following variables seem to have hexadecimal values.

Appending the values of all the variables in order and using an online hex to ascii converter, we can see that the string they form together is `FLAG{S***K-S*****S-ARE-BEST-STRINGS}`. That is the flag we needed.

## Challenge 3

For the final challenge, the executable we need to analyze is named `strings3.exe_`.

Just like our previous challenge, we import the file into `Ghidra`, we `autoanalyze` it, and then we look at the `entry` function.

At first glance, nothing seems like it would lead us anywhere. Investigating the variable `local_c`, we see there is a function `LoadStringA`. If we follow this function, we can find a read reference `XREF[1]:		entry:00402ff(R)`. Following this memory offset, we can identify the call highlighted bellow:

```
	004022ff	ff 15 0c	CALL	dword ptr [->USER32.DLL::LoadStringA]	= u"FLAG{R*******S-ARE-POPULAR-FOR-M*****E}"
				30 40 00													= 0000312a
```

The FLAG{} portion is what we need to complete the final challenge.